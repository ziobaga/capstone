@using System.Security.Claims
@model Capstone.Models.Matches

<div class="row justify-content-center">
    <div class="col-12 col-sm-10 col-md-8 col-lg-6">
        <div class="bg-custom rounded p-5 my-4 mx-3 shadow">
            <div class="text-center mb-4">
                <h2 class="text-green">Dettagli della Partita</h2>
            </div>

            <hr class="myBorder" />

            <div class="mb-4">
                <p><strong>Data:</strong> @Model.DataInizio.ToString("dd/MM/yyyy")</p>
                <p><strong>Ora Inizio:</strong> @Model.OraInizio.ToString(@"hh\:mm")</p>
                <p><strong>Ora Fine:</strong> @Model.OraFine.ToString(@"hh\:mm")</p>
                <p><strong>Campo:</strong> @Model.Campo.NomeCampo, @Model.Campo.Città</p>
            </div>

            <hr class="myBorder" />

            <div class="mb-4">
                <h3 class="mb-3">Partecipanti</h3>
                @if (Model.Partecipanti != null && Model.Partecipanti.Any())
                {
                    <ul class="list-group">
                        @foreach (var partecipante in Model.Partecipanti)
                        {
                            <li class="list-group-item d-flex justify-content-between align-items-center">
                                <span>
                                    @if (partecipante.Id == int.Parse(User.FindFirstValue(ClaimTypes.NameIdentifier)))
                                    {
                                        <a href="@Url.Action("Details", "Profile")" class="text-decoration-none" style="color: #58ae82;">
                                            @partecipante.Nome @partecipante.Cognome (@partecipante.Email)
                                        </a>
                                    }
                                    else
                                    {
                                        <a href="@Url.Action("ViewProfile", "Profile", new { userId = partecipante.Id })" class="text-decoration-none" style="color: #58ae82;">
                                            @partecipante.Nome @partecipante.Cognome (@partecipante.Email)
                                        </a>
                                    }
                                </span>
                            </li>
                        }
                    </ul>
                }
                else
                {
                    <p>Non ci sono partecipanti attualmente registrati per questa partita.</p>
                }
            </div>

            <hr class="myBorder" />

            <div class="mb-4">
                <h3 class="mb-3">Effettua la prenotazione e paga con Stripe</h3>
                <form asp-action="ProcessPayment" method="post">
                    <input type="hidden" name="matchId" value="@Model.Id" />
                    <script src="https://checkout.stripe.com/checkout.js" class="stripe-button"
                            data-key="pk_test_51Q0mODP563WlEe7GzbpE8o1vcQJohTT8ZVmlc0ELLPCGM1cdMX0tSfFW060DWExEoSl51A4OchRsjEmsqWP0Yyti00tyuIYFwP"
                            data-amount="@((long)((Model.OraFine - Model.OraInizio).TotalHours * (double)Model.Campo.PrezzoOrario * 100))"
                            data-name="Prenotazione Partita"
                            data-description="Prenota e paga la partita"
                            data-currency="eur"
                            data-locale="auto">
                    </script>
                </form>
            </div>

            <div class="d-flex justify-content-between">
                <a asp-controller="Match" asp-action="MatchList" class="btn secondButton">Annulla</a>
            </div>
        </div>
    </div>
</div>